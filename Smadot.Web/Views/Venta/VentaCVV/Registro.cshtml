@using Smadot.Models.Dicts;
@using Smadot.Utilities.FileStorage
@using Smadot.Models.Entities.IngresoFormaValorada.Response
@model IngresoFormaValoradaFormResponse
@{

    Layout = "~/Views/Shared/_LayoutSmadot.cshtml";
    ViewData["Title"] = "Finalizar Venta CVV";
}

@section styles {
    <link href="~/assets/plugins/custom/prismjs/prismjs.bundle.css" rel="stylesheet" type="text/css">
    <style>
        input:read-only {
            pointer-events: none;
            background: var(--kt-input-disabled-bg);
        }

        .fs-light-secondary {
            color: #8b704a !important;
            background: #e0ddd7 !important;
        }

        .fs-light-orange {
            color: #f57d06 !important;
            background: #f8ddc2 !important;
        }

        .fs-light-orange2 {
            color: #f54e06 !important;
            background: rgb(251, 200, 188) !important;
        }
    </style>
}

@section breadcrumb {
    <li class="breadcrumb-item">
        <a href="#" class="text-muted text-hover-primary">Trámites</a>
    </li>
    <li class="breadcrumb-item">
        <span class="bullet bg-gray-400 w-5px h-2px"></span>
    </li>
    <li class="breadcrumb-item">
        <a href="#" class="text-muted text-hover-primary">Certificados</a>
    </li>
    <li class="breadcrumb-item">
        <span class="bullet bg-gray-400 w-5px h-2px"></span>
    </li>
    <li class="breadcrumb-item">
        <a asp-controller="VentaCVV" asp-action="Index" class="text-muted text-hover-primary">Venta Formas Valoradas </a>
    </li>
    <li class="breadcrumb-item">
        <span class="bullet bg-gray-400 w-5px h-2px"></span>
    </li>
    <li class="active">@ViewData["Title"]</li>
}

@section toolbar {
    <a class="btn btn-sm fw-bold btn-primary" id="btnSave">Guardar</a>
    <a class="btn btn-sm fw-bold btn-secondary" asp-controller="IngresoFormaValorada" asp-action="Index">Cancelar</a>
}

<div class="row">
    <!--begin::Col-->
    <div class="col-md-12">
        <!--begin::List widget 1-->
        <div class="card card-flush h-lg-100">
            <div class="card-header">
                <h3 class="card-title">Finalizar Venta CVV</h3>
            </div>
            <form class="form" action="#" method="post" id="form_registro">

                <!--begin::Body-->
                <div class="card-body pt-5 row">
                    <div class="col-md-4">
                        <label class="form-label" asp-for="IdSolicitudFV">Número de Solicitud</label><br />
                        <input class="form-control form-control-solid" type="hidden" asp-for="IdIngresoFV" readonly />
                        <input class="form-control form-control-solid" type="text" asp-for="IdSolicitudFV" readonly />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label" asp-for="FechaSolicitud">Fecha de Solicitud &nbsp;</label><br />
                        <input class="form-control form-control-solid" type="text" asp-for="FechaSolicitud"
                               value="@(Model.FechaSolicitud.ToString("dd/MM/yyyy"))" readonly />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label" asp-for="Almacen">Almacén &nbsp;</label><br />
                        <input class="form-control form-control-solid" type="text" asp-for="Almacen" readonly />
                    </div>
                    <div class="clearfix"><br /></div>

                    <div class="col-md-4 form-group">
                        <label class="form-label" asp-for="FechaEntrega">
                            Fecha de Entrega: &nbsp;<strong class="obligatorio">*</strong>
                        </label>
                        <div class="position-relative">
                            <input class="form-control form-control-solid" asp-for="FechaEntrega" type="text" readonly
                                   disabled value="@(Model.FechaEntrega.ToString("dd/MM/yyyy"))" />
                            <div class="position-absolute translate-middle-y top-50 end-0 me-3">
                                <i class="fa-solid fa-calendar-days"
                                   onclick="document.getElementById('FechaEntrega').focus(); return false;"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4 fv-row">
                        <label class="form-label" asp-for="NombreRecibio">
                            Quién recibió: &nbsp;<strong class="obligatorio">*</strong>
                        </label>
                        <input class="form-control form-control-solid" readonly type="text" asp-for="NombreRecibio" />
                    </div>
                    <div class="clearfix"><br /></div>

                    <!--begin::Repeater-->
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label" for="FechaVenta">
                                Fecha Finalización de Venta: &nbsp;<strong class="obligatorio">*</strong>
                            </label>
                            <div class="position-relative">
                                <input class="form-control" id="FechaVenta" name="FechaVenta" />
                                <div class="position-absolute translate-middle-y top-50 end-0 me-3">
                                    <i class="fa-solid fa-calendar-days"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 fv-row">
                        <div class="form-group">

                            <label class="form-label" for="NumeroCompra">
                                Número de Compra: &nbsp;<strong class="obligatorio">*</strong>
                            </label>
                            <input class="form-control" id="NumeroCompra" name="NumeroCompra" />
                        </div>
                    </div>
                    <div class="col-md-4 fv-row">
                        <div class="form-group">
                            <label class="form-label" for="NumeroReferencia">
                                Número de Referencia: &nbsp;<strong class="obligatorio">*</strong>
                            </label>
                            <input class="form-control" type="text" id="NumeroReferencia" name="NumeroReferencia" />
                        </div>
                    </div>

                    <div class="d-flex mb-5">
                        <div class="py-2 px-4 col-md-4">
                            <label class="form-label">Documento 1</label><br />
                            <div class="fv-row">
                                <div class="dropzone" id="dropzonejs1">
                                    <div class="dz-message needsclick">
                                        <i class="bi bi-file-earmark-arrow-up text-primary fs-3x"></i>
                                        <div class="ms-4">
                                            <h3 class="fs-5 fw-bold text-gray-900 mb-1">
                                                Suelte los archivos aquí o haga clic para cargarlos.
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="py-2 px-4 col-md-4">
                            <label class="form-label">Documento 2</label><br />
                            <div class="fv-row">
                                <div class="dropzone" id="dropzonejs2">
                                    <div class="dz-message needsclick">
                                        <i class="bi bi-file-earmark-arrow-up text-primary fs-3x"></i>
                                        <div class="ms-4">
                                            <h3 class="fs-5 fw-bold text-gray-900 mb-1">
                                                Suelte los archivos aquí o haga clic para cargarlos.
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="py-2 px-4 col-md-4">
                            <label class="form-label">Documento 3</label><br />
                            <div class="fv-row">
                                <div class="dropzone" id="dropzonejs3">
                                    <div class="dz-message needsclick">
                                        <i class="bi bi-file-earmark-arrow-up text-primary fs-3x"></i>
                                        <div class="ms-4">
                                            <h3 class="fs-5 fw-bold text-gray-900 mb-1">
                                                Suelte los archivos aquí o haga clic para cargarlos.
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-body container align-items">
                        <span class="my-3 text-gray-700 parent-hover-primary fs-3 fw-bold">
                            Certificados
                        </span>
                        <hr />
                        <div class="row g-5 mb-10">

                            @foreach (var cantidad in Model.certificadosTotalData)
                            {
                                <div class="col-lg-3 contador-folios">
                                    <div class="card card-px-0 shadow-sm">
                                        @* <div class="card-header">
                                    </div> *@
                                        <h3 class="fs-3 px-3 m-0 pt-5">@cantidad.NombreCertificado</h3>
                                        <div class="card-body p-0">
                                            <div class="d-flex align-items-center">
                                                <div class="border border-gray-300 border-dashed rounded m-2 p-4">
                                                    <!--begin::Number-->
                                                    <div class="d-flex align-items-center">
                                                        <span class="fa fa-clipboard-list fs-3 text-warning me-2">
                                                        </span>
                                                        <div class="fs-2 fw-bold"
                                                         id="kt_countup_solicitadas_@cantidad.IdCatTipoCertificado"
                                                         data-kt-countup="true"
                                                         data-kt-countup-value="@cantidad.CantidadSolicitada"
                                                         data-kt-countup-prefix="">
                                                            0
                                                        </div>
                                                    </div>
                                                    <!--end::Number-->
                                                    <!--begin::Label-->
                                                    <div class="fw-semibold fs-6 ">Cantidad Solicitada</div>
                                                    <!--end::Label-->
                                                </div>
                                                <div class="border border-gray-300 border-dashed rounded m-5 p-4">
                                                    <!--begin::Number-->
                                                    <div class="d-flex align-items-center">
                                                        <span class="fa fa-file-invoice fs-3 text-secondary me-2">
                                                        </span>
                                                        <div class="fs-2 fw-bold count-up-rc"
                                                         data-idcertificado="@cantidad.IdCatTipoCertificado"
                                                         id="kt_countup_recibidas_@cantidad.IdCatTipoCertificado"
                                                         data-kt-countup="true"
                                                         data-kt-countup-value="@(cantidad.CantidadRecibida)"
                                                         data-kt-countup-prefix="">
                                                            0
                                                        </div>
                                                    </div>
                                                    <!--end::Number-->
                                                    <!--begin::Label-->
                                                    <div class="fw-semibold fs-6 ">Cantidad Recibida</div>
                                                    <!--end::Label-->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="row g-5 mb-10" id="container-datacertificados">

                            @{
                                var i = 0;
                            }
                            @foreach (var item in Model.certificados)
                            {

                                @if (item.Certificados.Count > 0)
                                {
                                    <h3 class="mb-5">@item.NombreCertificado - @item.Clave </h3>
                                    <div class="table-responsive">
                                        <table class="table table-rounded table-striped border  gs-7 gy-7 gx-7">
                                            <thead>
                                                <tr class="fw-semibold fs-6 text-gray-800 border-bottom border-gray-200">
                                                    <th class="w-25">Cantidad</th>
                                                    <th class="w-25">Folio Inicial</th>
                                                    <th class="w-25">Folio Final</th>
                                                    <th class="w-25">Precio Unitario</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var certificado in item.Certificados)
                                                {
                                                    <tr>

                                                        <td>
                                                            <input class="form-control" type="hidden" value="@certificado.IdIngresoCertificado" id="certificadoVentas[@i].IdIngresoCertificado" name="certificadoVentas[@i].IdIngresoCertificado" />
                                                            @certificado.CantidadRecibida
                                                        </td>
                                                        <td>@certificado.FolioInicial</td>
                                                        <td>@certificado.FolioFinal</td>
                                                        <td>
                                                            <div class="form-group">
                                                                <input class="form-control" type="number" id="certificadoVentas[@i].PrecioUnitario" name="certificadoVentas[@i].PrecioUnitario" />
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    i++;
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                    <hr />
                                }

                            }
                        </div>

                    </div>
                    <!--end::Body-->
                </div>
            </form>
        </div>
        <!--end::LIst widget 1-->
    </div>
    <!--end::Col-->
</div>

@section Scripts {
    <script src="~/lib/moment/js/moment-with-locales.js"></script>
    <script src="~/lib/daterangepicker/js/daterangepicker.js"></script>
    <script src="~/lib/es6-shim/dist/es6-shim.min.js"></script>
    <script src="~/assets/plugins/custom/prismjs/prismjs.bundle.js"></script>
    <script src="~/lib/formvalidation/dist/js/FormValidation.full.min.js"></script>
    <script src="~/lib/formvalidation/dist/js/plugins/Bootstrap.min.js"></script>
    <script src="~/js/Venta/smadot.ventaCVV.registro.js" asp-append-version="true"></script>
}